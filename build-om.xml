<project name="Turbine SQL" default="main" basedir=".">

  <!-- Allow any user specific values to override the defaults -->
  <property file="${user.home}/build.properties" />

  <!-- Set default values for the build -->
  <property file="build.properties" />
 

  <!-- ================================================================ -->
  <!-- I N I T  T A R G E T                                             -->
  <!-- ================================================================ -->
  <!-- We are placing the taskdef initialization in a target of its     -->
  <!-- because the classpath will not be loaded within the taskdef      -->
  <!-- if the taskdef is a child of the project. It must be placed      -->
  <!-- with a target to work. This is a work around for a problem       -->
  <!-- in Ant, but it solves the problem of not having to alter         -->
  <!-- the classpath in the .sh|.bat scripts.                           -->
  <!-- ================================================================ -->

  <target name="init">
    <taskdef name="torque-om"
      classname="org.apache.turbine.torque.TorqueObjectModelTask">
      <classpath>
        <pathelement location="${velocity.jar}"/>
        <pathelement location="${torque.jar}"/>
        <pathelement location="${xerces.jar}"/>
      </classpath>
    </taskdef>
  </target>

  <!-- ================================================================ -->
  <!-- M A I N  T A R G E T                                             -->
  <!-- ================================================================ -->
  <!-- Generate Turbine SQL schema for supported DBs                    -->
  <!-- ================================================================ -->

  <target name="main" depends="init">
    <antcall target="security-om"/>
    <antcall target="scheduler-om"/>
  </target>


  <target name="security-om" depends="init">

    <torque-om
      contextProperties="build.properties"
      controlTemplate="${OMControlTemplate}"
      outputDirectory="${build.dir}/src"
      templatePath="${templatePath}"
      outputFile="report.turbine.om.generation"
      targetPackage="${securityPackage}"
      xmlFile="${schemaDirectory}/turbine-schema.xml"
      targetDatabase="${database}"
    />

  </target>


  <target name="scheduler-om" depends="init">

    <torque-om
      contextProperties="build.properties"
      controlTemplate="${OMControlTemplate}"
      outputDirectory="${build.dir}/src"
      templatePath="${templatePath}"
      outputFile="report.turbine.scheduler.generation"
      targetPackage="${schedulerPackage}"
      xmlFile="${schemaDirectory}/scheduler-schema.xml"
      targetDatabase="${database}"
    />

  </target>

</project>
